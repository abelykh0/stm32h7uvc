#include <canvas.h>
#include "string.h"

uint8_t canvas[] __attribute__(( section(".sram2") ));
static Mcu* canvasMcu = (Mcu*)canvas;

// Y-Cb-Cr 64 color palette (indexed by RRGGBB)
uint8_t Colors[][3] =
{
	/*000000*/ {16, 128, 128},
	/*000001*/ {24, 165, 122},
	/*000010*/ {33, 203, 116},
	/*000011*/ {41, 240, 110},
	/*000100*/ {59, 103, 97},
	/*000101*/ {67, 141, 91},
	/*000110*/ {76, 178, 85},
	/*000111*/ {84, 215, 79},
	/*001000*/ {102, 79, 65},
	/*001001*/ {110, 116, 59},
	/*001010*/ {118, 153, 53},
	/*001011*/ {127, 190, 47},
	/*001100*/ {145, 54, 34},
	/*001101*/ {153, 91, 28},
	/*001110*/ {161, 128, 22},
	/*001111*/ {170, 166, 16},
	/*010000*/ {38, 115, 165},
	/*010001*/ {46, 153, 159},
	/*010010*/ {55, 190, 153},
	/*010011*/ {63, 227, 147},
	/*010100*/ {81, 91, 134},
	/*010101*/ {89, 128, 128},
	/*010110*/ {97, 165, 122},
	/*010111*/ {106, 203, 116},
	/*011000*/ {124, 66, 103},
	/*011001*/ {132, 103, 97},
	/*011010*/ {140, 141, 91},
	/*011011*/ {149, 178, 85},
	/*011100*/ {166, 41, 71},
	/*011101*/ {175, 79, 65},
	/*011110*/ {183, 116, 59},
	/*011111*/ {191, 153, 53},
	/*100000*/ {60, 103, 203},
	/*100001*/ {68, 140, 197},
	/*100010*/ {76, 177, 191},
	/*100011*/ {85, 215, 185},
	/*100100*/ {103, 78, 171},
	/*100101*/ {111, 115, 165},
	/*100110*/ {119, 153, 159},
	/*100111*/ {128, 190, 153},
	/*101000*/ {145, 53, 140},
	/*101001*/ {154, 91, 134},
	/*101010*/ {162, 128, 128},
	/*101011*/ {170, 165, 122},
	/*101100*/ {188, 29, 109},
	/*101101*/ {197, 66, 103},
	/*101110*/ {205, 103, 97},
	/*101111*/ {213, 141, 91},
	/*110000*/ {82, 90, 240},
	/*110001*/ {90, 128, 234},
	/*110010*/ {98, 165, 228},
	/*110011*/ {107, 202, 222},
	/*110100*/ {124, 66, 209},
	/*110101*/ {133, 103, 203},
	/*110110*/ {141, 140, 197},
	/*110111*/ {149, 177, 191},
	/*111000*/ {167, 41, 177},
	/*111001*/ {176, 78, 171},
	/*111010*/ {184, 115, 165},
	/*111011*/ {192, 153, 159},
	/*111100*/ {210, 16, 146},
	/*111101*/ {218, 53, 140},
	/*111110*/ {227, 91, 134},
	/*111111*/ {235, 128, 128},
};

void Clear(uint8_t color)
{
	uint8_t colorIndex = color & 0x0FFF;
	uint8_t yValue =  Colors[colorIndex][0];
	uint8_t cbValue = Colors[colorIndex][1];
	uint8_t crValue = Colors[colorIndex][2];
	for (int i = 0; i < MCU_WIDTH * MCU_HEIGHT; i++)
	{
		Mcu* mcu = &canvasMcu[i];
		memset(mcu->y,  yValue,  8 * 8);
		memset(mcu->cb, cbValue, 8 * 8);
		memset(mcu->cr, crValue, 8 * 8);
	}
}

// 40 x 30 8x8 squares
void Set8x8Pixels(int x, int y, uint8_t color)
{
	uint8_t smallColor = color & 0x0FFF;
	Mcu* mcu = &canvasMcu[x + (y * MCU_WIDTH)];
	memset(mcu->y,  Colors[smallColor][0], 8 * 8);
	memset(mcu->cb, Colors[smallColor][1], 8 * 8);
	memset(mcu->cr, Colors[smallColor][2], 8 * 8);
}

// 320 x 240
void SetPixel(int x, int y, uint8_t color)
{
	uint8_t colorIndex = color & 0x0FFF;
	Mcu* mcu = &canvasMcu[x / 8 + (y / 8 * MCU_WIDTH)];
	uint8_t xOffset = x % 8;
	uint8_t yOffset = y % 8;
	mcu->y[yOffset][xOffset]  = Colors[colorIndex][0];
	mcu->cb[yOffset][xOffset] = Colors[colorIndex][1];
	mcu->cr[yOffset][xOffset] = Colors[colorIndex][2];
}
